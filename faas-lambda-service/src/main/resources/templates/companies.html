<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Ghost Route - Companies</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="stylesheet" th:href="@{/css/companies.css}">
</head>
<body data-page="companies">

<div th:replace="~{fragments/sidebar :: sidebar}"></div>
<div th:replace="~{fragments/header  :: header}"></div>

<div class="main-content" id="mainContent">
    <div class="page-header">
        <h2 class="page-heading">Companies</h2>
        <p class="page-subtitle">Add, edit and manage all your shippers, brokers and carriers.</p>
    </div>

    <div class="companies-layout">

        <!-- LEFT: FORM -->
        <div class="card company-form-card fade-in">
            <div class="card-header">
                <h3 class="card-title">Add / Edit Company</h3>
                <div class="card-icon">
                    <i class="bi bi-buildings-fill"></i>
                </div>
            </div>

            <form class="company-form"
                  th:action="@{/companies}"
                  th:object="${companyForm}"
                  method="post">

                <input type="hidden" th:field="*{id}"/>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Company name</label>
                        <input type="text"
                               class="form-input"
                               placeholder="Ghost Route Logistics LLC"
                               th:field="*{name}"
                               required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">MC number</label>
                        <input type="text"
                               class="form-input"
                               placeholder="MC 123456"
                               th:field="*{mcNumber}">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Type</label>
                        <select class="form-select" th:field="*{type}">
                            <option value="" disabled
                                    th:selected="${companyForm.type} == null">Select type</option>
                            <option value="RAIL">Rail</option>
                            <option value="CONSOLIDATION">Consolidation</option>
                            <option value="OTR">OTR</option>
                            <option value="BROKERAGE">Brokerage</option>
                            <option value="OTHER">Other</option>
                        </select>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-save"></i>
                        <span th:text="${companyForm.id} != null ? 'Update company' : 'Add company'">
                            Add company
                        </span>
                    </button>

                    <button type="reset" class="btn btn-secondary-outline">
                        <i class="bi bi-x-circle"></i>
                        Clear
                    </button>
                </div>
            </form>
        </div>

        <!-- RIGHT: LIST -->
        <div class="card company-list-card fade-in">
            <div class="card-header">
                <h3 class="card-title">Companies list</h3>
                <div class="card-icon">
                    <i class="bi bi-list-task"></i>
                </div>
            </div>

            <div class="table-toolbar">
                <div class="table-search">
                    <i class="bi bi-search"></i>
                    <input type="text"
                           class="form-input table-search-input"
                           placeholder="Search by name, MC or type..."
                           oninput="filterCompanies(this.value)">
                </div>
            </div>

            <div class="table-responsive">
                <table class="data-table companies-table" id="companiesTable">
                    <thead>
                    <tr>
                        <th>Name</th>
                        <th>MC #</th>
                        <th>Type</th>
                        <th class="text-right">Actions</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="company : ${companies}">
                        <td th:text="${company.name}">Ghost Route Logistics LLC</td>
                        <td th:text="${company.mcNumber}">MC 123456</td>
                        <td>
                            <span class="badge badge-muted company-type-badge"
                                  th:text="${company.type}">
                                OTR
                            </span>
                        </td>
                        <td class="text-right companies-actions">
                            <a class="btn-icon edit"
                               th:href="@{/companies/edit/{id}(id=${company.id})}">
                                <i class="bi bi-pencil"></i>
                            </a>
                            <a class="btn-icon delete"
                               th:href="@{/companies/delete/{id}(id=${company.id})}"
                               onclick="return confirm('Delete this company?');">
                                <i class="bi bi-trash"></i>
                            </a>
                        </td>
                    </tr>

                    <tr th:if="${#lists.isEmpty(companies)}">
                        <td colspan="5" class="empty-state">
                            <i class="bi bi-inbox"></i>
                            <span>No companies yet. Add your first company on the left.</span>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

    </div>
</div>

<div th:replace="~{fragments/footer :: footer}"></div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const page = document.body.getAttribute('data-page');
        const items = document.querySelectorAll('.sidebar .menu-item');
        items.forEach(function (i) {
            if (i.dataset.page === page) {
                i.classList.add('active');
            }
        });
    });

    function filterCompanies(query) {
        const q = query.toLowerCase();
        const rows = document.querySelectorAll('#companiesTable tbody tr');
        rows.forEach(function (row) {
            const text = row.innerText.toLowerCase();
            row.style.display = text.includes(q) ? '' : 'none';
        });
    }
</script>

</body>
</html>
